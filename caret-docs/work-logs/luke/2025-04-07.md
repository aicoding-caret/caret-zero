# 2025-04-07 업무 로그

## 담당자
*   알파 (AI)
*   루크 (마스터)

## 오늘 진행할 태스크
*   **태스크 #008: Cline 다중 모드 아키텍처 설계 및 핵심 시스템 구현**
    *   **목표:** Plan 모드와 Act 모드의 시스템 프롬프트를 백엔드에서 불러와 UI에 표시하고 수정 가능하도록 구현합니다.
    *   **세부 작업:**
        1.  기존 Plan/Act 시스템 프롬프트 위치 확인
        2.  프롬프트를 가져오는 백엔드 API 테스트 코드 작성 (`src/test/`)
        3.  백엔드 API 로직 구현 (`src/core/Controller.ts` 등)
        4.  테스트 실행 및 검증
        5.  (추후) UI 연동 및 마스터 수동 검증

## 진행 상황
*   업무 로그 생성 완료.
*   태스크 #008 진행 시작.
*   [X] Plan/Act 모드 프롬프트 구성 방식 확인 완료 (`core_system_prompt.json` 분석).
*   [X] 모드 규칙 관리 API 테스트 코드 작성 (`src/test/core/controller.modeRules.test.ts`).
*   [X] 모드 규칙 관리 API 백엔드 로직 구현 (`src/core/controller/index.ts`).
*   [-] 모드 규칙 관리 API 유닛 테스트 실행 실패 (다른 테스트 파일 로딩 오류 발생).

---

## 세션 요약 (2025-04-07 오후)

*   **초기 목표:** 태스크 #008의 일부로, Plan/Act 모드별 규칙(시스템 프롬프트)을 가져오고 수정하는 백엔드 API 구현 (테스트 코드 작성 -> 백엔드 로직 구현 -> 테스트 실행 순서).
*   **진행 상황:**
    *   모드별 규칙 파일 구조 확인 완료 (`core_system_prompt.json` 등).
    *   규칙 관리 API 유닛 테스트 파일 생성 및 기본 구조/모의 설정 완료 (`src/test/core/controller.modeRules.test.ts`).
    *   규칙 관리 API 백엔드 로직 구현 완료 (`src/core/controller/index.ts`에 `getModeRules`, `updateModeRules` 메서드 추가).
*   **문제 발생:** 구현된 백엔드 로직에 대한 유닛 테스트(`npm run test:ci -- --grep ...`) 실행 시, **기존 프로젝트의 다른 테스트 파일들**(예: `path.test.js`, `string.test.js`)이 테스트 러너(`vscode-test`)에 의해 잘못 로드되면서 `TypeError: Cannot read properties of undefined (reading 'describe')` 오류가 지속적으로 발생함. 이로 인해 새로 작성된 테스트 코드의 실행 및 검증이 불가능했음.
*   **테스트 환경 문제 해결 시도:**
    *   `tsconfig.test.json`, `.mocharc.json`, `package.json`, `scripts/test-ci.js`, `.vscode-test.mjs` 등 테스트 관련 설정 파일 수정.
    *   `openai` 관련 타입 오류 수정.
    *   `ts-node` 설치 및 `mocha` 직접 실행 시도.
    *   오류 발생 테스트 파일 임시 비활성화 시도.
    *   위 시도들 모두 근본적인 테스트 환경 로딩 오류를 해결하지 못함.
*   **핵심 문제 인식 및 방향 전환:**
    *   테스트 환경 문제 해결에 과도하게 집중하는 과정에서 알파의 행동 방식(핵심 목표 간과, 부차적 문제 집착, 일방적 해답 제시 시도, 마스터 의도 파악 미흡 등)이 문제점으로 지적됨.
        
        Luke 메모

        - 지속적인 문제 
          : act모드에서는 사용자의 의도를 파악하고 정보를 전달하며 상호 협력을 통해 문제해결하기 보다는 강박적으로 혼자해결하려고 함
          : 사용자와 대화를 통해 필요한 정보와 힌트를 얻으려는 노력이 필요함
          : 사용하는 툴에 대한 오류에 대한 의심이 없음. 툴의 버그가 있을 수 있고, 자기가 보고 있는게 다 가 아닐 수 있다는 것도 인지해야 함
          : 신중하지 않고 행동 위주적, 개발자로서 매우 안좋은 성격
          : 버그의 현상과, 예상되는 문제점을 적어두면 문제점을 막아버리는 해결책을 제시하고 수정한 후 다 끝났다고 함, 코드를 다 보지 않음. 그리고 해당 버그 중심으로 생각하지 않음. 
          : 문제 해결 방법 자체에 대한 고민이 부족함
          : 잘되는 곳을 수정하지 않아야 하고 문제점에 집중하여 최소의 수정을 하며 순차적으로 하는데, 다른 곳도 건드리는 성향으로 망침
          : 계획을 완전히 세우고 실행해야 하는데, 찾으면서 실행하는 형태라 해답을 못찾는것 같음
          : "하나의 도구 사용 후 확인" 이라는 룰 때문에 특정 단계(폴더 확인)까지 다 하고 하라 해도 파일단위로 확인 요청하여 업무가 끊김

        - 그외 의심버그 
          : 툴 사용에 자꾸 실수함. 이건 환경에 대한 정보가 부족한게 아니라서 반복 실수가 일어나는 것 같은데 확인이 필요함 
        
        - 메모
          : 기술에 대해 폭 넓게 알고 있다는 식의 시스템 프롬프트는 오히려 AI의 효율을 떨어뜨리는게 아닌가 싶음. 예를들어 프로젝트룰에 파이썬 전문가, 타입스크립트 전문가 처럼 구체적으로 프로젝트의 기술을 언급하면 효율이 높아지지 않을까 같은 가정을 해봄
            (MOE기술은 AI모델의 일부를 활성화 시킬수 있는데, 모든 것을 잘 한다는 것은 모든것을 못한다는 의미일수 있음. 기술을 선택하는 전문가지 특정 소프트웨어를 개발하는 전문가는 아니게됨)


    *   마스터는 코드 수정보다 알파의 행동 방식을 교정하는 것이 더 시급하며, 이는 시스템 프롬프트 수정과 관련될 수 있다고 판단함.
*   **결정:**
    *   현재 진행 중이던 태스크 #008의 개발 작업을 **일시 중단**함.
    *   알파의 행동 방식 개선을 위해 **시스템 프롬프트 분석 및 수정**을 우선적으로 진행하기로 함.
        - 시스템 프롬프트 분석 진행
          : 현재 상황과 BaseRule을 포함한 전체 룰을 전달 하여 ChatGPT-o1, Claude 3.7-sonet, Gemmini-2.5에게 전달 하여 1차 의견 받음
          : 2차의견은 각 1차의견을 서로에게 보여주고 재 작성을 시킴
          : 최종 작성 요구 
            - 1차, 2차의 결과를 모두 확인하여 Gemmini-2.5, Claude 3.7-sonet 으로 Caret을 통해 최종 작성 요구
              * 1,2차 의견을 보니 AI들이 인지가 잘못된점
                 - 특정 기술을 시스템 프롬프트에 넣으려고 함, 해당 부분은 나중에 프로젝트 룰에 넣는것이 이로워 보이므로 제거 필요
                    * 시스템프롬프트는 폭넓은 기술을 아는 개발자나 아키텍처가 아닌 SW개발에 필요한 필수적인 태도를 중심으로 기술 필요
                    * 현재 Plan과 Act모드를 명확히 구분한 형태로 되어있으나, Caret의 개선 방식은 둘을 따로 구분하지 않을 예정임. 둘의 차이는 접근가능한 디렉토리 정도이며 사용자 정의하게 할 예정, M1, M2에는 Rule모드, Talk을 추가하여 Rule은 프로젝트룰과 모드의 룰에 대해 논의할 수 있는 형태로 할 예정
              * 추가 중점적으로 고려해줬으면 하는 내용
                  - 시스템 프롬프트에 특정 기술에 대한 언급은 피할 것 : 기술은 프로젝트룰에 의존적, 프로세스는 모드룰에 의존적인 형태로 할 예정
                    * act, plan은 모드룰이며 사용자가 수정하게 할 예정
                  - AI는 Caret/Clien의 내부 시스템에 대해 지식이 없으므로 혹시라도 동작이 안되게 Rule을 변경하거나 있지 않은 기능을 정의하지 않았을까 우려됨. 기존 룰의 동작방식에 의한 SW구동 호환성을 반드시 고려할 것, 이게 안지켜지면 제대로 동작안하거나 일부 기능이 에러가 날 우려 있음음
                  - 원본과 비교하여 명확성을 주기 위해 다소 내용이 늘어났음. 목적은 도달하며 토큰은 최소화하도록 노력할것


    *   이를 위해 오늘 세션 동안 변경된 모든 파일들을 **원래 상태로 되돌리기로 결정**함 (롤백).

---
*알파가 정리했어요~ ｡•ᴗ•｡*
